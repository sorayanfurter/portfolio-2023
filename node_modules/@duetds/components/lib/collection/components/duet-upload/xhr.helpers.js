/*!
 * Built with Duet Design System
 */
export const makeXhrRequest = ({ payload, options, onFailure, onSuccess, onProgress }) => {
  // @ts-ignore
  const { type = "POST", xhr, uri, argument = null, headers = null } = options;
  xhr.open(type, `${uri}${argument || ""}`, true);
  const { data, name } = payload;
  // headers must be added after open
  if (headers) {
    Object.keys(headers).forEach(key => {
      xhr.setRequestHeader(key, headers[key]);
    });
  }
  if (type === "POST") {
    xhr.onreadystatechange = () => {
      // Call a function when the state changes.
      if (xhr.readyState === XMLHttpRequest.DONE && xhr.status >= 200 && xhr.status < 300) {
        // Request finished without errors
        onSuccess(xhr, name, xhr.status);
      }
      if (xhr.readyState === XMLHttpRequest.DONE && xhr.status >= 300 && xhr.status < 999) {
        // Request finished with errors
        onFailure(xhr, name, xhr.status);
      }
    };
    onProgress(name);
  }
  xhr.send(data);
  return xhr;
};
